# üöÄ UPLOAD TO HUGGING FACE - INSTRUCTIONS

## Your Space
**URL**: https://huggingface.co/spaces/AGN768/backend

## Current Status
‚ùå **Space is created but empty (503 Error)**
- No files uploaded yet
- Environment variables not set

---

## STEP 1: Upload Files (Choose ONE method)

### Option A: Web UI Upload (EASIEST) ‚≠ê

1. Go to: https://huggingface.co/spaces/AGN768/backend
2. Click "Files" tab at the top
3. Click "Add file" ‚Üí "Upload files"
4. Drag and drop ALL files from this folder:
   ```
   ‚úì full_api.py
   ‚úì db_conn.py
   ‚úì processor.py
   ‚úì cloudinary_helper.py
   ‚úì requirements.txt
   ‚úì Dockerfile
   ‚úì .dockerignore
   ‚úì README.md
   ‚úì cv modifier/ (entire folder - drag the folder)
   ```
5. Write commit message: "Initial backend deployment"
6. Click "Commit changes to main"

**DO NOT UPLOAD**: ENV_VARIABLES_REFERENCE.txt (this file contains secrets!)

### Option B: Git Clone & Push

```powershell
# Clone your space
cd "d:\AGN website"
git clone https://huggingface.co/spaces/AGN768/backend hf-backend
cd hf-backend

# Copy all files
Copy-Item ..\huggingface_deploy\* . -Recurse -Force

# Remove reference file (don't upload secrets)
Remove-Item ENV_VARIABLES_REFERENCE.txt
Remove-Item UPLOAD_INSTRUCTIONS.txt

# Commit and push
git add .
git commit -m "Deploy AGN Job Bank backend"
git push
```

### Option C: Push from Main Repository (RECOMMENDED) ‚úÖ

**Use this method to push updates from your main AGN website repository:**

```powershell
# Navigate to your main repository
cd "d:\AGN website"

# Check git remotes (you should see both 'origin' and 'huggingface')
git remote -v

# Stage all changes you want to push
git add huggingface_deploy_clean/
git add backend/full_api.py
git add backend/requirements.txt
# Add any other modified files

# Commit the changes
git commit -m "Update Hugging Face deployment files"

# Push to GitHub (optional - for backup)
git push origin add-readme-to-main

# Push to Hugging Face Space (CRITICAL - this updates your live app)
git push huggingface HEAD:main
```

**IMPORTANT NOTES:**
- The repository has TWO remotes:
  - `origin` = GitHub (https://github.com/Raja-Ayyaz/agn-frontend.git)
  - `huggingface` = Hugging Face Space (https://huggingface.co/spaces/AGN768/backend)
- Pushing to `origin` does NOT update your Hugging Face app
- You MUST push to `huggingface` remote to update the live deployment
- Command: `git push huggingface HEAD:main` pushes your current branch to HF main

---

## STEP 2: Set Environment Variables ‚ö†Ô∏è CRITICAL

1. Go to: https://huggingface.co/spaces/AGN768/backend
2. Click "Settings" tab
3. Scroll down to "Variables and secrets"
4. Click "New secret"
5. Add each variable from `ENV_VARIABLES_REFERENCE.txt`:

**Database Variables** (6 variables):
```
Name: DB_HOST         Value: gateway01.eu-central-1.prod.aws.tidbcloud.com
Name: DB_PORT         Value: 4000
Name: DB_USER         Value: 4YoWi5wpZWfFZMg.root
Name: DB_PASSWORD     Value: rM9HHqklqdSdDSfi
Name: DB_NAME         Value: agn
Name: DB_POOL_SIZE    Value: 10
```

**Cloudinary Variables** (3 variables):
```
Name: Cloudinary_Cloud_Name    Value: daknxfxvv
Name: Cloudinary_API_Key       Value: 782796493951941
Name: Cloudinary_API_Secret    Value: uhw7NmEOPTfRv4b9cyasDe25hBc
```

**IMPORTANT**: Check the "Secret" box for each variable!

---

## STEP 3: Wait for Build

After uploading files and setting variables:

1. Go to your space: https://huggingface.co/spaces/AGN768/backend
2. Click "Logs" tab
3. Wait 5-10 minutes for Docker build
4. Look for these success messages:
   ```
   ‚úÖ Database connection pool ready
   üéâ Database connection pool initialized successfully
   ```
5. Status should change from "Building" ‚Üí "Running"

---

## STEP 4: Test Your API

### Test 1: Health Check
Open in browser or run:
```powershell
Invoke-WebRequest -Uri "https://AGN768-backend.hf.space/api/health"
```
Expected response: `{"ok": true, "service": "full_api"}`

### Test 2: Database Connection
```powershell
Invoke-WebRequest -Uri "https://AGN768-backend.hf.space/api/employees?limit=1"
```
Should return employee data from your database

### Test 3: Search Employees
```
https://AGN768-backend.hf.space/api/employees?role=Software%20Engineer
```

---

## STEP 5: Update Frontend

Once your backend is running, update your frontend config:

**File**: `frontend/my-react-app/src/Api/Config/config.js`

```javascript
const CONFIG = {
  BASE_URL: 'https://AGN768-backend.hf.space'
};

export default CONFIG;
```

---

## Troubleshooting

### Build Fails
- **Check Logs tab** for error messages
- Common issues:
  - Missing Dockerfile ‚Üí Upload it
  - Wrong requirements.txt name ‚Üí Must be named `requirements.txt`

### Runtime Errors
- **Database connection fails**:
  - Verify all DB_* environment variables are set
  - Check DB_PASSWORD is correct
  
- **Cloudinary upload fails**:
  - Verify Cloudinary_* variables are set
  - Check API keys are correct

### 503 Error Persists
- Files not uploaded yet ‚Üí Upload all files
- Still building ‚Üí Wait 10 minutes
- Build failed ‚Üí Check Logs tab for errors

---

## Files in This Folder

```
9 files ready to upload:

Core Application:
  ‚úì full_api.py (35 KB) - Main Flask API
  ‚úì db_conn.py (12 KB) - Database connection pooling
  ‚úì processor.py (2 KB) - CV processor shim
  ‚úì cloudinary_helper.py (6 KB) - File upload helper

Configuration:
  ‚úì requirements.txt (2 KB) - Python dependencies
  ‚úì Dockerfile (1 KB) - Docker build config
  ‚úì .dockerignore (1 KB) - Exclude unnecessary files
  ‚úì README.md (2 KB) - Space documentation

CV Processing:
  ‚úì cv modifier/ (folder with 5 Python files)

Reference (DO NOT UPLOAD):
  ‚ö†Ô∏è ENV_VARIABLES_REFERENCE.txt - Set these in Settings instead
  ‚ö†Ô∏è UPLOAD_INSTRUCTIONS.txt - This file
```

---

## Expected Timeline

- File upload: 2-5 minutes
- Set variables: 2-3 minutes
- Docker build: 5-10 minutes
- **Total: ~15-20 minutes**

---

## Success Checklist

- [ ] All 9 items uploaded to space
- [ ] All 9 environment variables set as secrets
- [ ] Logs show "Database connection pool ready"
- [ ] Status shows "Running" (not "Building" or "Error")
- [ ] /api/health returns {"ok": true}
- [ ] /api/employees returns data
- [ ] Frontend updated with new BASE_URL

---

**You're almost there! Just upload and configure! üöÄ**
